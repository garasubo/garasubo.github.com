---
title: "Xenで使っているディスクイメージの容量拡張"
pubDate: "2015-02-20"
tags: ["xen"]
description: "XenでArchLinuxの仮想マシンのディスク容量を拡張する手順"
---

Ubuntu 14.04にXenを入れてその上でArch Linux(2015-01版）を動かしている。
ディスク容量が足りなくなったので増やそうと思ったのだが、virt-managerあたりからはいけそうな雰囲気がなかったので、
適当に調べた方法を試したら上手くいった。

念の為、ディスクイメージのバックアップをとっておくことを推薦

1. Ubuntu上でディスクイメージの後ろにほしい長さ分だけ追加
    ディスクイメージは`/var/lib/libvirt/images`の中とかにある。
```
dd if=/dev/zero bs=512M count=20 >> arch.img
```
2. ゲストOS上でパーティションを再構築`fdisk`とかで一番後ろのパーティションを一度`d`で破壊して、`n`でもう1回つくるとき後ろまで最大限まで伸ばす。
    その後`w`で保存。自分の場合、マウントされているパーティションを伸ばしているので、認識させるには一度再起動する必要がある。
3. 再起動後、`resize2fs`でパーティションを拡張、`df -h`でパーティションが拡張されていることを確認。

参考：[Xenで使用しているディスクイメージを拡張する | misty-magic.h](https://mistymagich.wordpress.com/2014/08/16/xen%E3%81%A7%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%A6%E3%81%84%E3%82%8B%E3%83%87%E3%82%A3%E3%82%B9%E3%82%AF%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E6%8B%A1%E5%BC%B5%E3%81%99%E3%82%8B/)
